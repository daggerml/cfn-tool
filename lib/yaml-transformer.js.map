{
  "version": 3,
  "file": "yaml-transformer.js",
  "sourceRoot": "..",
  "sources": [
    "lib/yaml-transformer.coffee"
  ],
  "names": [],
  "mappings": ";AAAA;AAAA,MAAA,eAAA,EAAA,MAAA,EAAA,YAAA,EAAA,SAAA,EAAA,OAAA,EAAA,KAAA,EAAA,KAAA,EAAA,MAAA,EAAA;;EAAA,IAAA,GAAU,OAAA,CAAQ,SAAR;;EACV,MAAA,GAAU,OAAA,CAAQ,QAAR;;EAEV,MAAA,GAAS,QAAA,CAAC,KAAD,CAAA;WACP,MAAM,CAAA,SAAE,CAAA,QAAQ,CAAC,IAAjB,CAAsB,KAAtB,CAA4B;EADrB;;EAGT,KAAA,GAAQ,QAAA,CAAC,GAAD,EAAM,GAAN,EAAW,QAAM,KAAjB,CAAA;AACR,QAAA,CAAA,EAAA;IAAE,IAAA,GAAQ,GAAG,CAAC,KAAJ,CAAU,GAAV;IACR,CAAA,GAAQ,IAAI,CAAC,GAAL,CAAS,IAAI,CAAC,MAAd,EAAsB,KAAtB,CAAA,GAA+B;WACvC,IAAI,YAAO,CAAC,MAAZ,CAAmB,IAAI,SAAK,CAAC,IAAV,CAAe,GAAf,CAAnB;EAHM;;EAKR,YAAA,GAAe,QAAA,CAAC,KAAD,CAAA;AACf,QAAA;IAAE,MAAM,CAAC,EAAP,QAAU,MAAA,CAAO,KAAP,OACR,YADQ,QAER,eAFQ,QAGR,MAHF,EAIG,CAAA,wBAAA,CAAA,CAA2B,IAAI,CAAC,SAAL,CAAe,KAAf,CAA3B,CAAA,CAJH;WAKA;EANa;;EAQf,OAAA,GAAU,QAAA,CAAA,GAAC,IAAD,CAAA;AACV,QAAA,CAAA,EAAA,CAAA,EAAA,GAAA,EAAA;IAAE,GAAA,GAAM,CAAA;IACN,KAAsC,0FAAtC;MAAA,GAAG,CAAC,IAAI,CAAC,CAAA,GAAE,CAAH,CAAL,CAAH,GAAiB,IAAI,CAAC,CAAA,GAAE,CAAF,GAAI,CAAL;IAArB;WACA;EAHQ;;EAKV,KAAA,GAAQ,QAAA,CAAA,GAAC,IAAD,CAAA;WACN,MAAM,CAAC,MAAM,CAAC,KAAd,CAAoB,IAApB,EAA0B,IAA1B;EADM;;EAGR,SAAA,GAAY,QAAA,CAAC,CAAD,EAAI,CAAJ,CAAA;AACZ,QAAA;AAAE;aAAI,CAAI,MAAM,CAAC,SAAP,CAAiB,CAAjB,EAAoB,CAApB,EAAR;KAA+B,aAAA;MAAM;aAAO,MAAb;;EADrB,EA3BZ;;;;;EAkCM,kBAAN,MAAA,gBAAA;IACE,WAAa,CAAA,CAAA;MACX,IAAC,CAAA,IAAD,GAAY;MACZ,IAAC,CAAA,MAAD,GAAY,CAAA;MACZ,IAAC,CAAA,QAAD,GAAY,CAAA;MACZ,IAAC,CAAA,QAAD,GAAY;MACZ,IAAC,CAAA,QAAD,GAAY;IALD;;IAOb,KAAO,CAAA,GAAC,GAAD,CAAA;MACL,MAAM,IAAI,KAAJ,CAAU,CAAA,GAAA,CAAA,CAAM,IAAC,CAAA,QAAQ,CAAC,IAAV,CAAe,GAAf,CAAN,CAAA,EAAA,CAAA,CAA8B,GAAG,CAAC,IAAJ,CAAS,GAAT,CAA9B,CAAA,CAAV;IADD;;IAGP,UAAY,CAAC,EAAD,CAAA;AACd,UAAA;MAAI,EAAA,GAAM,MAAM,CAAC,IAAP,CAAY,EAAZ;aACN,IAAC,CAAA,OAAD,CAAS,EAAT,EAAa,CAAA,CAAA,GAAA;eACX,EAAE,CAAC,MAAH,CAAU,CAAC,CAAC,GAAD,EAAM,CAAN,CAAA,GAAA;AACjB,cAAA;UAAQ,CAAA,GAAI,EAAE,CAAC,CAAD;iBACN,IAAC,CAAA,OAAD,CAAS,CAAT,EAAY,CAAA,CAAA,GAAA;AACpB,gBAAA,CAAA,EAAA;YAAU,CAAA,GAAO,CAAC,CAAA,GAAI,IAAC,CAAA,QAAQ,CAAC,CAAD,CAAd,CAAH,GACF,CAAA,CAAE,CAAF,CADE,GAEI,CAAC,CAAA,GAAI,IAAC,CAAA,MAAM,CAAC,CAAD,CAAZ,CAAH,GACH,CAAA,CAAE,IAAC,CAAA,IAAD,CAAM,CAAN,CAAF,CADG,GAGH,OAAA,CAAQ,CAAR,EAAW,IAAC,CAAA,IAAD,CAAM,CAAN,CAAX;YACF,IAAG,EAAE,CAAC,MAAH,KAAa,CAAhB;qBAAuB,EAAvB;aAAA,MAAA;qBAA8B,KAAA,CAAM,GAAN,EAAW,YAAA,CAAa,CAAb,CAAX,EAA9B;;UAPU,CAAZ;QAFS,CAAD,CAAV,EAUG,CAAA,CAVH;MADW,CAAb;IAFU;;IAeZ,SAAW,CAAC,EAAD,CAAA;aACT,IAAC,CAAA,OAAD,CAAS,EAAT,EAAa,CAAA,CAAA,GAAA;eACX,EAAE,CAAC,GAAH,CAAO,CAAC,CAAD,EAAI,CAAJ,CAAA,GAAA;iBACL,IAAC,CAAA,OAAD,CAAS,CAAA,CAAA,CAAG,CAAH,CAAA,CAAT,EAAiB,CAAA,CAAA,GAAA;mBAAG,IAAC,CAAA,IAAD,CAAM,CAAN;UAAH,CAAjB;QADK,CAAP;MADW,CAAb;IADS;;IAKX,IAAM,CAAC,KAAD,CAAA;AACR,UAAA;MAAI,GAAA;AAAM,gBAAO,MAAA,CAAO,KAAP,CAAP;AAAA,eACC,QADD;mBACe,IAAC,CAAA,UAAD,CAAY,KAAZ;AADf,eAEC,OAFD;mBAEe,IAAC,CAAA,SAAD,CAAW,KAAX;AAFf;mBAGC;AAHD;;MAIN,IAAG,SAAA,CAAU,KAAV,EAAiB,GAAjB,CAAH;eAA8B,IAA9B;OAAA,MAAA;eAAuC,IAAC,CAAA,IAAD,CAAM,GAAN,EAAvC;;IALI;;IAON,OAAS,CAAC,GAAD,EAAM,CAAN,CAAA;AACX,UAAA;MAAI,IAAC,CAAA,QAAQ,CAAC,IAAV,CAAe,GAAf;MACA,GAAA,GAAM,CAAA,CAAA;MACN,IAAC,CAAA,QAAQ,CAAC,GAAV,CAAA;aACA;IAJO;;IAMT,OAAS,CAAC,GAAD,EAAM,CAAN,CAAA;AACX,UAAA;MAAI,IAAC,CAAA,QAAQ,CAAC,IAAV,iDAAe,GAAG,CAAE,MAAO,KAAK,CAAC,KAAlB,CAAA,CAAyB,CAAC,OAA1B,CAAkC,OAAlC,EAA2C,GAA3C,mBAAf;MACA,GAAA,GAAM,CAAA,CAAA;MACN,IAAC,CAAA,QAAQ,CAAC,GAAV,CAAA;aACA;IAJO;;IAMT,MAAQ,CAAC,GAAD,EAAM,IAAN,CAAA;AACV,UAAA,IAAA,EAAA,CAAA,EAAA,IAAA,EAAA,GAAA,EAAA;MAAI,IAAA,GAAO,QAAA,CAAC,IAAD,CAAA;eAAU,OAAA,CAAQ,IAAR,EAAc,IAAd;MAAV;AACP;MAAA,KAAA,qCAAA;;QACE,IAAC,CAAA,IAAI,CAAC,IAAN,CAAW,IAAI,IAAI,CAAC,IAAT,CAAc,GAAd,EAAmB;UAAC,IAAD;UAAO,SAAA,EAAW;QAAlB,CAAnB,CAAX;MADF;aAEA;IAJM;;IAMR,QAAU,CAAC,SAAD,EAAY,GAAZ,EAAiB,IAAjB,EAAuB,IAAvB,CAAA;AACZ,UAAA;MAAI,KAAA,GAAQ,CAAA,CAAA,CAAA,CAAI,GAAJ,CAAA;;QACR,OAAQ,CAAA,IAAA,CAAA,CAAO,GAAP,CAAA;;MACR,IAAC,CAAA,MAAD,CAAQ,KAAR,EAAe,IAAf;MACA,IAAG,IAAH;QACE,SAAS,CAAC,IAAD,CAAT,GAAkB,CAAA,GAAC,IAAD,CAAA,GAAA;AACxB,cAAA;AAAQ;mBACE,IAAI,CAAC,KAAL,CAAW,IAAX,EAAiB,IAAjB,EADF;WAEA,aAAA;YAAM;mBAAO,IAAC,CAAA,KAAD,CAAO,CAAP,EAAb;;QAHgB,EADpB;;aAKA;IATQ;;IAWV,UAAY,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,CAAA;MACV,KAAmC,IAAnC;QAAA,CAAC,IAAD,EAAO,IAAP,CAAA,GAAe,CAAC,IAAD,EAAO,IAAP,EAAf;;aACA,IAAC,CAAA,QAAD,CAAU,IAAC,CAAA,QAAX,EAAqB,GAArB,EAA0B,IAA1B,EAAgC,IAAhC;IAFU;;IAIZ,QAAU,CAAC,GAAD,EAAM,IAAN,EAAY,IAAZ,CAAA;MACR,KAAmC,IAAnC;QAAA,CAAC,IAAD,EAAO,IAAP,CAAA,GAAe,CAAC,IAAD,EAAO,IAAP,EAAf;;aACA,IAAC,CAAA,QAAD,CAAU,IAAC,CAAA,MAAX,EAAmB,GAAnB,EAAwB,IAAxB,EAA8B,IAA9B;IAFQ;;IAIV,KAAO,CAAC,SAAD,CAAA;MACL,IAAoB,MAAA,CAAO,SAAP,CAAA,KAAuB,QAA3C;AAAA,eAAO,UAAP;;aACA,IAAI,CAAC,QAAL,CAAc,SAAd,EAAyB;QAAC,MAAA,EAAQ,IAAI,CAAC,MAAM,CAAC,MAAZ,CAAmB,IAAC,CAAA,IAApB;MAAT,CAAzB;IAFK;;IAIP,IAAM,CAAC,GAAD,CAAA;aACJ,IAAI,CAAC,QAAL,CAAc,GAAd;IADI;;IAGN,SAAW,CAAC,SAAD,CAAA;MACT,IAAC,CAAA,QAAQ,CAAC,MAAV,CAAiB,CAAjB;MACA,IAAC,CAAA,QAAQ,CAAC,MAAV,CAAiB,CAAjB;aACA,IAAC,CAAA,IAAD,CAAM,IAAC,CAAA,IAAD,CAAM,IAAC,CAAA,KAAD,CAAO,SAAP,CAAN,CAAN;IAHS;;EAlFb;;EAuFA,MAAM,CAAC,OAAP,GAAiB;AAzHjB",
  "sourcesContent": [
    "yaml    = require 'js-yaml'\nassert  = require 'assert'\n\ntypeOf = (thing) ->\n  Object::toString.call(thing)[8...-1]\n\nsplit = (str, sep, count=Infinity) ->\n  toks  = str.split(sep)\n  n     = Math.min(toks.length, count) - 1\n  toks[0...n].concat(toks[n..].join(sep))\n\nassertObject = (thing) ->\n  assert.ok(typeOf(thing) in [\n    'Object'\n    'Undefined'\n    'Null'\n  ], \"expected an Object, got #{JSON.stringify(thing)}\")\n  thing\n\nhashMap = (args...) ->\n  ret = {}\n  ret[args[2*i]] = args[2*i+1] for i in [0...args.length/2]\n  ret\n\nmerge = (args...) ->\n  Object.assign.apply(null, args)\n\ndeepEqual = (x, y) ->\n  try not assert.deepEqual(x, y) catch e then false\n\n#=============================================================================#\n# TRANSFORMER BASE CLASS                                                      #\n#=============================================================================#\n\nclass YamlTransformer\n  constructor: ->\n    @tags     = []\n    @macros   = {}\n    @specials = {}\n    @keystack = []\n    @objstack = []\n\n  abort: (msg...) ->\n    throw new Error(\"at #{@keystack.join('/')}: #{msg.join(' ')}\")\n\n  walkObject: (xs) ->\n    ks  = Object.keys(xs)\n    @withObj xs, =>\n      ks.reduce(((ret, k) =>\n        v = xs[k]\n        @withKey k, =>\n          v = if (s = @specials[k])\n            s(v)\n          else if (m = @macros[k])\n            m(@walk(v))\n          else\n            hashMap(k, @walk(v))\n          if ks.length is 1 then v else merge(ret, assertObject(v))\n      ), {})\n\n  walkArray: (xs) ->\n    @withObj xs, =>\n      xs.map (v, i) =>\n        @withKey(\"#{i}\", => @walk(v))\n\n  walk: (thing) ->\n    ret = switch typeOf(thing)\n      when 'Object' then @walkObject(thing)\n      when 'Array'  then @walkArray(thing)\n      else thing\n    if deepEqual(thing, ret) then ret else @walk(ret)\n\n  withObj: (obj, f) ->\n    @objstack.push(obj)\n    ret = f()\n    @objstack.pop()\n    ret\n\n  withKey: (key, f) ->\n    @keystack.push(key?.split?(/ +/).shift().replace(/^Fn::/, '!'))\n    ret = f()\n    @keystack.pop()\n    ret\n\n  deftag: (tag, long) ->\n    emit = (form) -> hashMap(long, form)\n    for kind in ['scalar', 'sequence', 'mapping']\n      @tags.push(new yaml.Type(tag, {kind, construct: emit}))\n    @\n\n  _defform: (namespace, tag, long, emit) ->\n    short = \"!#{tag}\"\n    long ?= \"Fn::#{tag}\"\n    @deftag(short, long)\n    if emit\n      namespace[long] = (args...) =>\n        try\n          emit.apply(null, args)\n        catch e then @abort e\n    @\n\n  defspecial: (tag, long, emit) ->\n    [long, emit] = [emit, long] unless emit\n    @_defform(@specials, tag, long, emit)\n\n  defmacro: (tag, long, emit) ->\n    [long, emit] = [emit, long] unless emit\n    @_defform(@macros, tag, long, emit)\n\n  parse: (textOrDoc) ->\n    return textOrDoc if typeOf(textOrDoc) isnt 'String'\n    yaml.safeLoad(textOrDoc, {schema: yaml.Schema.create(@tags)})\n\n  dump: (doc) ->\n    yaml.safeDump(doc)\n\n  transform: (textOrDoc) ->\n    @keystack.splice(0)\n    @objstack.splice(0)\n    @dump(@walk(@parse(textOrDoc)))\n\nmodule.exports = YamlTransformer\n"
  ]
}