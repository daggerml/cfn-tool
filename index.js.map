{
  "version": 3,
  "file": "index.js",
  "sourceRoot": "",
  "sources": [
    "index.coffee"
  ],
  "names": [],
  "mappings": "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",
  "sourcesContent": [
    "fs                  = require 'fs'\nos                  = require 'os'\npath                = require 'path'\nsq                  = require 'shell-quote'\nGetOpts             = require './lib/GetOpts'\nyaml                = require 'js-yaml'\n{strict: assert}    = require 'assert'\ncompletions         = require './lib/completions'\nfn                  = require './lib/fn'\nlog                 = require './lib/log'\nCfnError            = require './lib/CfnError'\nCfnTransformer      = require './lib/cfn-transformer'\n{version: VERSION}  = require './package.json'\nAWS_VERSIONS        = [1, 2]\n\nquit = (msg, status = 0) ->\n  console.log msg if msg\n  process.exit status\n\nabort = (e) ->\n  e = new CfnError(e.message) if e.code is 'ENOENT'\n  body = if e instanceof CfnError then e.body else e.body or e.stack\n  log.error(e.message, {body})\n  process.exit 1\n\nprocess.on 'uncaughtException', abort\n\noptions = new GetOpts(\n  alias:\n    bucket:     'b'\n    config:     'c'\n    help:       'h'\n    keep:       'k'\n    linter:     'l'\n    parameters: 'P'\n    profile:    'p'\n    quiet:      'q'\n    region:     'r'\n    tags:       't'\n    verbose:    'v'\n    version:    'V'\n  boolean: [\n    'help'\n    'keep'\n    'quiet'\n    'verbose'\n    'version'\n  ]\n  string:\n    bucket:     '<name>'\n    config:     '<file>'\n    linter:     '<command>'\n    parameters: '\"<key>=<val> ...\"'\n    profile:    '<name>'\n    region:     '<name>'\n    tags:       '\"<key>=<val> ...\"'\n  positional:\n    command:    null\n    template:   '<template-file>'\n    stackname:  '<stack-name>'\n  opt2var: (opt) ->\n    switch opt\n      when 'profile' then 'AWS_PROFILE'\n      when 'region' then 'AWS_REGION'\n      else \"CFN_TOOL_#{opt.toUpperCase()}\"\n  complete:\n    bucket:     completions.none\n    config:     completions.none\n    linter:     completions.none\n    parameters: completions.none\n    profile:    completions.profile\n    region:     completions.region\n    tags:       completions.none\n    template:   completions.none\n    stackname:  completions.none\n  unknown: (x) -> abort new CfnError(\"unknown option: '#{x}'\")\n)\n\ndefaultOptionsSpec = [\n  'help'\n  'version'\n  'command'\n]\n\noptionsSpecs =\n  deploy: [\n    'bucket'\n    'config'\n    'help'\n    'keep'\n    'linter'\n    'parameters'\n    'profile'\n    'quiet'\n    'region'\n    'tags'\n    'verbose'\n    'command'\n    'template'\n    'stackname'\n  ]\n  transform: [\n    'config'\n    'help'\n    'linter'\n    'profile'\n    'quiet'\n    'region'\n    'tags'\n    'verbose'\n    'command'\n    'template'\n  ]\n  update: [\n    'config'\n    'help'\n    'parameters'\n    'profile'\n    'quiet'\n    'region'\n    'verbose'\n    'command'\n    'stackname'\n  ]\n\nallCmds = Object.keys(optionsSpecs)\n\nusageCmd = (prog, cmd) ->\n  options.configure(if cmd then optionsSpecs[cmd] else defaultOptionsSpec)\n  lpad  = (x) -> \"  #{x}\"\n  opts  = options.usage().map(lpad).join(\"\\n\")\n  \"#{prog}#{if cmd then \" #{cmd}\" else ''}#{if opts then \"\\n#{opts}\" else ''}\"\n\nusage = (prog, cmd, status) ->\n  manp  = [prog].concat(if cmd then [cmd] else []).join('-')\n  ucmd  = fn.partial usageCmd, null, prog\n  text  = if cmd then ucmd(cmd) else [null].concat(allCmds).map(ucmd).join(\"\\n\\n\")\n  quit \"\"\"\n    #{text}\n\n    See the manpage:\n    * cmd: man #{manp}\n    * url: http://htmlpreview.github.io/?https://github.com/daggerml/cfn-tool/blob/#{VERSION}/man/#{manp}.html\n  \"\"\", status\n\nversion = () ->\n  quit VERSION\n\nbashCompletion = ([$0, prefix, prev]) ->\n  log.transports.forEach((x) -> x.silent = true)\n  words = sq.parse(process.env.COMP_LINE).slice(1)\n  words.pop() if prefix\n  command = words[0]\n  if $0 is prev and words.length < 2\n    options.configure defaultOptionsSpec, false\n    quit completions.list prefix, allCmds.concat(options.completeOpt(words))\n  else if (spec = optionsSpecs[command])\n    fs.writeFileSync '/tmp/t', \"got here 1\"\n    options.configure spec, false\n    opts = options.completeOpt()\n    if prev in opts\n      quit(c(prefix)) if (c = options.master.complete[prev.replace(/^-+/, '')])\n    if prefix.startsWith('-')\n      quit completions.list prefix, options.completeOpt(words)\n    opts = options.parse words, {noenv: true}\n    for x in options.config.positional\n      continue if opts[x]\n      quit(c(prefix)) if (c = options.master.complete[x])\n    quit()\n  quit completions.file prefix\n\nmodule.exports = (completionArgs) ->\n  bashCompletion(completionArgs) if completionArgs\n\n  if (spec = optionsSpecs[process.argv[2]]) then options.configure(spec)\n  else options.configure(defaultOptionsSpec, false)\n\n  prog        = path.basename(process.argv[1])\n  argv        = process.argv.slice(2)\n  opts        = options.parse argv, {key: 'config', file: '.cfn-tool'}\n  opts.tmpdir = fn.tmpdir 'cfn-tool-', opts.keep\n  cmdKnown    = (opts.command in allCmds) or not opts.command\n\n  fn.assertOk cmdKnown, \"unknown command: '#{opts.command}'\"\n\n  switch\n    when opts.help        then usage(prog, opts.command)\n    when opts.version     then version()\n    when not opts.command then usage(prog, null, 1)\n\n  options.validateArgs(opts)\n\n  switch opts.command\n    when 'transform'\n      Object.assign opts,\n        dovalidate: false\n        dopackage:  false\n        bucket:     'example-bucket'\n        s3bucket:   'example-bucket'\n\n      log.verbose 'preparing template'\n      cfn = new CfnTransformer {opts}\n      res = cfn.writeTemplate(opts.template)\n\n      console.log fs.readFileSync(res.tmpPath).toString('utf-8').trimRight()\n    when 'deploy'\n      Object.assign opts,\n        dovalidate: true\n        dopackage:  true\n        s3bucket:   opts.bucket\n\n      log.info 'preparing templates'\n      cfn = new CfnTransformer {opts}\n      res = cfn.writeTemplate(opts.template)\n\n      if res.nested.length > 1\n        throw new CfnError('bucket required for nested stacks') unless opts.bucket\n        log.info 'uploading templates to S3'\n        fn.execShell \"aws s3 sync --size-only '#{opts.tmpdir}' 's3://#{opts.bucket}/'\"\n\n      bucketarg = \"--s3-bucket '#{opts.bucket}' --s3-prefix aws/\" if opts.bucket\n      paramsarg = \"--parameter-overrides #{opts.parameters}\"      if opts.parameters\n      tagsarg   = \"--tags #{opts.tags}\"                           if opts.tags\n\n      log.info 'deploying stack'\n      fn.execShell \"\"\"\n        aws cloudformation deploy \\\n          --template-file '#{res.tmpPath}' \\\n          --stack-name '#{opts.stackname}' \\\n          --capabilities CAPABILITY_NAMED_IAM CAPABILITY_IAM CAPABILITY_AUTO_EXPAND \\\n          #{bucketarg or ''} #{paramsarg or ''} #{tagsarg or ''}\n      \"\"\"\n\n      log.info 'done -- no errors'\n    when 'update'\n      res = JSON.parse fn.execShell \"\"\"\n        aws cloudformation describe-stacks --stack-name '#{opts.stackname}'\n      \"\"\"\n\n      params = res?.Stacks?[0]?.Parameters?.reduce(\n        (xs, x) ->\n          k = x.ParameterKey\n          fn.assoc xs, k, \"ParameterKey=#{k},UsePreviousValue=true\"\n        {}\n      )\n      fn.assertOk Object.keys(params).length, \"stack '#{opts.stackname}' has no parameters\"\n\n      haveOverride = null\n      for x in (opts.parameters?.split(/ +/) or [])\n        [k, v] = fn.split(x, '=', 2)\n        fn.assertOk k and v, \"parameter: expected <key>=<value>: got '#{x}'\"\n        fn.assertOk params[k], \"stack '#{opts.stackname}' has no parameter '#{k}'\"\n        haveOverride = params[k] = \"ParameterKey=#{k},ParameterValue=#{v}\"\n\n      fn.assertOk haveOverride, 'parameter overrides required'\n\n      paramsarg = objVals(params).join(' ')\n\n      fn.execShell \"\"\"\n        echo aws cloudformation update-stack \\\n          --stack-name #{opts.stackname} \\\n          --parameters #{paramsarg} \\\n          --capabilities CAPABILITY_IAM CAPABILITY_NAMED_IAM CAPABILITY_AUTO_EXPAND \\\n          ----use-previous-template\n      \"\"\"\n\n      log.info 'done -- no errors'\n\n  quit()\n"
  ]
}